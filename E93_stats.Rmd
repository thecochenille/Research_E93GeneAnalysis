---
title: 'Supplementary text: Materials and Methods - Statistical analyses for JHM treatments (A case of insect female neoteny:
  E93 expression and links to the juvenile hormone in mealybugs)'
author: "Isabelle Vea"
date: "September 28, 2017"
output:
  word_document:
    fig_caption: yes
    keep_md: yes
  pdf_document: default
  html_document:
    keep_md: yes
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

#Summary
You will find here all the analyses related to the statistics of hormonal treatments carried out in Vea et al. (submitted to Journal of Insect Biochemistry and Molecular Biology). 


```{r}
setwd("/Users/isabelle/Dropbox/_Github_reps/E93/")
library(ggplot2)
library(plyr)
library(tidyr)
```


#Effect of pyriproxyfen treatment
##Data
```{r}
#loading file JHM treatment
#females
dtf<-read.csv(file="E93-Pyr-N3D0.csv",header = TRUE)
names(dtf)
head(dtf)
dtf<-gather(dtf,Gene,SDM,9:16)
#dtf
head(dtf)

#males
dtm<-read.csv(file="E93-Pyr-male.csv",header = TRUE)
names(dtm)
head(dtm)
```

##Checking for data distribution 
```{r}
#female dataset subsetting to keep Kr-h1 and E93 1 and 2 subset from D4 to D8
dtf<-subset(dtf, Gene=="Kr.h1" | Gene=="PkE93.1"| Gene=="PkE93.2"| Gene=="PkE93.3")
dtf<-subset(dtf, Day == 4 |Day == 5 |Day == 6 |Day == 7 |Day == 8 )
dtf$Gene
dtf$Day
```


###Female dataset for PkKr-h1
```{r}
#all female dataset Kr-h1
dtfkrh1<-subset(dtf, Gene=="Kr.h1")
dtfkrh1$Gene
hist(dtfkrh1$SDM/dtfkrh1$rpL32, main="Distribution of all data  PkKr-h1/rpL32, regardless of treatment type")#not normal
```

The distribution of qPCR data collected for relative expression of PkKr-h1 is nor normal. We decided to transform the data to log10.

```{r}
  #log transformed
hist(log10(dtfkrh1$SDM/dtfkrh1$rpL32)) #more or less normal
```

We also checked data distribution by treatment

```{r}
#by treatment
dtfkrh1CT<-subset(dtfkrh1,Compound=="Control")
dtfkrh1CT$Compound
dtfkrh1JHM<-subset(dtfkrh1,Compound=="Mimic")
dtfkrh1JHM$Compound

hist(dtfkrh1CT$SDM/dtfkrh1CT$rpL32, main="Distribution of   PkKr-h1/rpL32 data, including only control treatments")
hist(dtfkrh1JHM$SDM/dtfkrh1JHM$rpL32, main="Distribution of   PkKr-h1/rpL32 data, including only mimic treatments")

  #log transformed
hist(log10(dtfkrh1CT$SDM/dtfkrh1CT$rpL32)) #ok
hist(log10(dtfkrh1JHM$SDM/dtfkrh1JHM$rpL32)) #skewed normal
```




```{r}
#all female dataset E93 1
dtfE931<-subset(dtf, Gene=="PkE93.1")
dtfE931$Gene
hist(dtfE931$SDM/dtfE931$rpL32) #distribution not normal
  #log transformed
hist(log10(dtfE931$SDM/dtfE931$rpL32) )

#by treatment
dtfE931CT<-subset(dtfE931,Compound=="Control")
dtfE931CT$Compound
dtfE931JHM<-subset(dtfE931,Compound=="Mimic")
dtfE931JHM$Compound

hist(dtfE931CT$SDM/dtfE931CT$rpL32) #not normal
hist(dtfE931JHM$SDM/dtfE931JHM$rpL32)
  
  #log transformed
hist(log10(dtfE931CT$SDM/dtfE931CT$rpL32)) #two peaks
hist(log10(dtfE931JHM$SDM/dtfE931JHM$rpL32)) #weird!


#male dataset subset Krh1 and E93 1
head(dtm)
#subsetting Kr-h1 and E93 1
dtm<-subset(dtm, Gene=="Kr-h1" | Gene=="PkE93-1"| Gene=="PkE93-2"| Gene=="PkE93-3")
dtm$Gene

#subsetting from D3 to D6
dtm<-subset(dtm, Day == 3| Day == 4| Day == 5| Day == 6)
dtm$Day

#all male krh1
dtmkrh1<-subset(dtm, Gene=="Kr-h1")
dtmkrh1$Gene
names(dtmkrh1)
hist(dtmkrh1$SDM.Gene/dtmkrh1$SDM.rpL32) #not normally distributed
  
  #log transformed
hist(log10(dtmkrh1$SDM.Gene/dtmkrh1$SDM.rpL32)) #not normally distributed


#male Krh1 by treatment
#by treatment
dtmkrh1CT<-subset(dtmkrh1,treatment=="Control")
dtmkrh1CT$treatment
dtmkrh1JHM<-subset(dtmkrh1,treatment=="Mimic")
dtmkrh1JHM$treatment

names(dtmkrh1CT)
hist(dtmkrh1CT$SDM.Gene/dtmkrh1CT$SDM.rpL32)
hist(dtmkrh1JHM$SDM.Gene/dtmkrh1JHM$SDM.rpL32)

  #log transformed
hist(log(dtmkrh1CT$SDM.Gene/dtmkrh1CT$SDM.rpL32)) #ok
hist(log(dtmkrh1JHM$SDM.Gene/dtmkrh1JHM$SDM.rpL32)) #ok
```
We decided to use a log10 transformation of our absolute values normalized by the reference gene because the histograms did not show a normal distribution.


#statistical tests: general effect of JHM
## male on Kr-h1 expression by treatment and by day 
```{r}
par(mfrow=c(2,2))
#dtm
dtkrh1<-subset(dtm,Gene=="Kr-h1") #subsetting the dataset to have only Kr-h1
dtkrh1$Gene
is.numeric(dtkrh1$Day)
dtkrh1$treatment
names(dtkrh1)

#fitting linear model on transformed data
malelmkrh1<-lm(log10((dtkrh1$SDM.Gene/dtkrh1$SDM.rpL32))~dtkrh1$treatment+dtkrh1$Day+dtkrh1$treatment:dtkrh1$Day)
summary.lm(malelmkrh1) #there is no effect of interaction between treatment type and day after treatment


malelmkrh12<-lm(log10((dtkrh1$SDM.Gene/dtkrh1$SDM.rpL32))~dtkrh1$treatment+dtkrh1$Day)
summary.lm(malelmkrh12) #effect of treatment and day
plot(malelmkrh1)

```

The treatment has a significant effect on PkKr-h1 expression (p-value < 2e-16 if not considering the interaction between treatment and day after treatment) and the expression changes over time.


## male on E93-1 expression by treatment and by day
```{r}
par(mfrow=c(2,2))
dtE931<-subset(dtm,Gene=="PkE93-1")
dtE931$Gene
dtE931$Day
is.numeric(dtE931$Day)
names(dtE931)

#transformed lm
malelmE931<-lm(log10((dtE931$SDM.Gene/dtE931$SDM.rpL32))~dtE931$treatment+dtE931$Day+dtE931$treatment:dtE931$Day)
summary.lm(malelmE931)  # no significant interaction

#remove interaction
malelmE9312<-lm(log10((dtE931$SDM.Gene/dtE931$SDM.rpL32))~dtE931$treatment+dtE931$Day)
summary.lm(malelmE9312)

plot(malelmE931)
```
There is a significant effect of the treatment on E93 isoform 1 in males.

## male on E93-2 expression by treatment and by day
```{r}
par(mfrow=c(2,2))
dtE932<-subset(dtm,Gene=="PkE93-2")
dtE932$Gene
dtE932$Day
is.numeric(dtE932$Day)
names(dtE932)

#transformed lm
malelmE932<-lm(log10((dtE932$SDM.Gene/dtE932$SDM.rpL32))~dtE932$treatment+dtE932$Day+dtE932$treatment:dtE932$Day)
summary.lm(malelmE932)

#remove interaction
malelmE932<-lm(log10((dtE932$SDM.Gene/dtE932$SDM.rpL32))~dtE932$treatment+dtE932$Day)
summary.lm(malelmE932)

plot(malelmE932)
```
There is a significant effect of treatment on E93 isoform 2 in males.

## male on E93-3 expression by treatment and by day
```{r}
par(mfrow=c(2,2))
dtE933<-subset(dtm,Gene=="PkE93-3")
dtE933$Gene
dtE933$Day
is.numeric(dtE933$Day)
names(dtE933)

#transformed lm
malelmE933<-lm(log10((dtE933$SDM.Gene/dtE933$SDM.rpL32))~dtE933$treatment+dtE933$Day+dtE933$treatment:dtE933$Day)
summary.lm(malelmE933)

#remove interaction
malelmE933<-lm(log10((dtE933$SDM.Gene/dtE933$SDM.rpL32))~dtE933$treatment+dtE933$Day)
summary.lm(malelmE933)

plot(malelmE933)
```
There is no significant effect of the treatment on E93 isoform 3 in males.

## Female on Kr-h1 expression by treatment and by day
```{r}
par(mfrow=c(2,2))
dtfkrh1<-subset(dtf,Gene=="Kr.h1")
dtfkrh1$Gene
dtfkrh1$Day
is.numeric(dtfkrh1$Day)
names(dtfkrh1)

femalelmkrh1<-lm(log10((dtfkrh1$SDM/dtfkrh1$rpL32))~dtfkrh1$Compound+dtfkrh1$Day+dtfkrh1$Compound:dtfkrh1$Day)
summary.lm(femalelmkrh1)

#remove interaction
femalelmkrh12<-lm(log10((dtfkrh1$SDM/dtfkrh1$rpL32))~dtfkrh1$Compound+dtfkrh1$Day)
summary.lm(femalelmkrh12)

plot(femalelmkrh1)
```
There is a significant effect of treatment on Kr-h1 in females.

## female on E93-1 expression by treatment and by day
```{r}
par(mfrow=c(2,2))
dtf$Gene
dtfE931<-subset(dtf,Gene=="PkE93.1")
dtfE931$Gene
is.numeric(dtfE931$Day)
names(dtfE931)
femalelmE931<-lm(log((dtfE931$SDM/dtfE931$rpL32))~dtfE931$Compound+dtfE931$Day+dtfE931$Compound:dtfE931$Day)
summary.lm(femalelmE931) #no effect from interaction

femalelmE931<-lm(log((dtfE931$SDM/dtfE931$rpL32))~dtfE931$Compound+dtfE931$Day)
summary.lm(femalelmE931)


plot(femalelmE931)
```
There is a significant effect of the treatment on E93 isoform 1 when only looking at treatment.


## female on E93-2 expression by treatment and by day
```{r}
par(mfrow=c(2,2))
dtf$Gene
dtfE932<-subset(dtf,Gene=="PkE93.2")
dtfE932$Gene
is.numeric(dtfE932$Day)
names(dtfE932)
femalelmE932<-lm(log((dtfE932$SDM/dtfE932$rpL32))~dtfE932$Compound+dtfE932$Day+dtfE932$Compound:dtfE932$Day)
summary.lm(femalelmE932)# no effect of interaction

femalelmE932<-lm(log((dtfE932$SDM/dtfE932$rpL32))~dtfE932$Compound+dtfE932$Day)
summary.lm(femalelmE932)

plot(femalelmE932)

```
There is no significant effect of treatment in E93 isoform 2 in females

## female on E93-3 expression by treatment and by day
```{r}
par(mfrow=c(2,2))
dtf$Gene
dtfE933<-subset(dtf,Gene=="PkE93.3")
dtfE933$Gene
is.numeric(dtfE933$Day)
names(dtfE933)
femalelmE933<-lm(log((dtfE933$SDM/dtfE933$rpL32))~dtfE933$Compound+dtfE933$Day+dtfE933$Compound:dtfE933$Day)
summary.lm(femalelmE933)

femalelmE933<-lm(log((dtfE933$SDM/dtfE933$rpL32))~dtfE933$Compound+dtfE933$Day)
summary.lm(femalelmE933)

plot(femalelmE933)
```

Although E93 isoform 3 expression changes over time, there is no significant effect of the treatment.